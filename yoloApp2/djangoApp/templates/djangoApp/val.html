{% load static %}
<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Val用アノテーションワークスペース</title>
        <link rel="stylesheet" href="{% static 'djangoApp/css/annotation.css' %}" />
    </head>
    <body data-page-type="val">
        <header>
            <div>
                <p class="dataset-badge">Valデータセット</p>
                <h1>Val用アノテーション</h1>
                <p>画像取り込み → クラス設定 → アノテーション作成 → val.zip書き出し</p>
            </div>
            <nav>
                <a href="{% url 'home' %}">← ホームに戻る</a>
                <span>現在のクラス: <strong id="activeClassDisplay">—</strong></span>
            </nav>
        </header>

        <div class="layout">
            <aside id="classPanel">
                <div class="panel-header">
                    <h2>クラス管理</h2>
                    <!-- 
                    <button class="btn-outline" type="button" data-panel-close>閉じる</button>
                    -->
                </div>
                <p class="muted">矩形を登録する前にアクティブなクラスを選択してください。</p>
                <ul class="class-list" id="classList"></ul>
                <form id="classForm">
                    <label for="className">新しいクラス</label>
                    <input id="className" name="className" type="text" placeholder="例: Pedestrian" required />
                    <div class="color-row">
                        <label for="classColor">表示色</label>
                        <input id="classColor" name="classColor" type="color" value="#38bdf8" />
                    </div>
                    <button type="submit" id="classFormSubmit">クラスを追加</button>
                    <button type="button" class="btn-outline" id="cancelEditBtn" hidden>編集をキャンセル</button>
                </form>
            </aside>
            <main class="workspace">
                <div class="workspace-header">
                    <h2>画像エリア</h2>
                    <button class="btn-outline panel-toggle" type="button" data-panel-toggle>
                        クラスパネルを表示
                    </button>
                    <div class="bulk-actions">
                        <div class="view-toggle" role="group" aria-label="画像表示サイズ">
                            <button type="button" data-view-size="small">小</button>
                            <button type="button" data-view-size="medium" class="is-active">中</button>
                            <button type="button" data-view-size="large">大</button>
                        </div>
                        <button class="btn-outline" type="button" id="selectAllImages">すべて選択</button>
                        <button class="btn-outline" type="button" id="clearSelection">選択解除</button>
                        <button class="btn-danger" type="button" id="deleteSelectedImages" disabled>選択した画像を削除</button>
                        <span class="selection-counter" id="selectionCounter" hidden>0枚選択中</span>
                    </div>
                </div>
                <section class="dropzone" id="dropzone">
                    <input id="imageInput" type="file" accept="image/*" multiple hidden />
                    <p class="dataset-badge">ドラッグ&ドロップ対応</p>
                    <h3>画像を追加</h3>
                    <p>ここにファイルをドロップするか、クリックしてファイル選択ダイアログを開きます。</p>
                </section>
                <section class="image-grid" id="imageGrid">
                    <div class="empty-state">
                        まだ画像がありません。上のエリアにドラッグ&ドロップすると、ここに一覧表示されます。
                    </div>
                </section>
                <div class="workspace-footer">
                    <button class="btn-secondary" type="button" id="colabBtn">Colabで学習する</button>
                    <button class="btn-secondary" type="button" id="goInferenceBtn">推論画面へ移動</button>
                    <button type="button" id="exportBtn">完了（val.zipをエクスポート）</button>
                </div>
            </main>
        </div>

        <div class="modal" id="exportModal" aria-hidden="true">
            <div class="modal-content">
                <h3>val.zipをエクスポートしますか？</h3>
                <p>
                    現在のアノテーション結果をYOLO形式のval.zipにまとめてダウンロードします。ブラウザのダウンロードフォルダに保存されます。
                </p>
                <div class="modal-actions">
                    <button class="btn-outline" type="button" data-modal-close>キャンセル</button>
                    <button type="button" id="confirmExport">エクスポート</button>
                </div>
            </div>
        </div>

        <div class="toast" id="toast" role="status" aria-live="polite"></div>

        <script
            src="{% static 'djangoApp/js/annotation.js' %}"
            data-page-type="val"
            data-export-url="{% url 'export_val_zip' %}"
            data-export-name="val.zip"
            data-inference-url="{% url 'inference' %}"
            data-colab-url="https://colab.research.google.com/drive/1gs3ujkr-Mw9_IVzg0NQ-n2VrtWdyAJQN?authuser=1"
            defer
        ></script>
    </body>
</html>
